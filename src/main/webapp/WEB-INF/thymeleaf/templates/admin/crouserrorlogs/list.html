<!-- src/main/webapp/WEB-INF/thymeleaf/templates/admin/crouserrorlogs/list.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sd="http://www.thymeleaf.org/spring-data"
      layout:decorate="~{layouts/user.html}">
<head>
    <meta charset="UTF-8"/>
    <title th:text="#{common.crous}">Erreurs CROUS</title>
</head>
<body>
<div layout:fragment="content">
    <h2 th:text="#{common.crous}">Erreurs CROUS</h2>
    <div class="well">
        <span th:text="#{crous.errors.description}">ESUP-SGC enregistre en base les éventuelles erreurs rencontrées lors de la synchronisation de l'ayant droit (RightHolder) et/ou de la carte.</span><br/>
        <span th:text="#{crous.errors.listing}">Cette page présente le listing de ces erreurs.</span><br/>
        <span th:text="#{crous.errors.wiki}">Nous maintenons une page wiki ESUP qui tente de lister et expliquer chaque erreur possible que peut rencontrer esup-sgc, merci de vous y référer :</span>
        <a target="_blank" href="https://www.esup-portail.org/wiki/display/SGC/Erreurs+CROUS">https://www.esup-portail.org/wiki/display/SGC/Erreurs+CROUS</a>
    </div>
    <div class="row">
        <div class="col-md-10">
            <form th:action="@{/admin/crouserrorlogs}" role="search" method="get" class="well" th:object="${searchCrousErrorLog}">
                <div class="row">
                    <div class="col-md-3">
                        <label th:text="#{common.blocking}">Bloquant</label>
                        <select class="form-control" th:field="*{blocking}">
                            <option value=""></option>
                            <option value="true">true</option>
                            <option value="false">false</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label th:text="#{common.esupsgc}">ESUP-SGC Operation</label>
                        <select class="form-control" th:field="*{esupSgcOperation}">
                            <option value=""></option>
                            <option th:each="op : ${esupSgcOperations}" th:value="${op}" th:text="${op}"></option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label th:text="#{common.code}">Code</label>
                        <select class="form-control" th:field="*{code}">
                            <option value=""></option>
                            <option th:each="c : ${codes}" th:value="${c}" th:text="${c}"></option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label th:text="#{list.error.message}">Message d'erreur</label>
                        <select class="form-control" th:field="*{message}">
                            <option value=""></option>
                            <option th:each="msg : ${crousMessages}" th:value="${msg}" th:text="${msg}"></option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <br/>
                        <button type="submit" class="btn btn-success"   th:text="#{list.filter}">Filtrer</button>
                    </div>
                </div>
            </form>
        </div>
        <div class="col-md-2">
            <div>
                <a th:href="@{/admin/crouserrorlogs(csv='')}" class="btn btn-primary" th:text="#{crous.errors.export.csv}">Export CSV</a>
            </div>
            <br/>
            <div>
                <form th:action="@{/admin/crouserrorlogs}" method="post">
                    <input type="hidden" name="_method" value="delete"/>
                    <button class="btn btn-danger" type="submit" th:text="#{crous.errors.purge}">Purger les logs</button>
                </form>
            </div>
        </div>
    </div>
    <div>
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th th:text="#{list.card}">Carte</th>
                    <th th:text="#{list.account}">Compte</th>
                    <th th:text="#{common.name}">Nom</th>
                    <th th:text="#{common.mail}">Mail</th>
                    <th>CSN</th>
                    <th><a class="sorting" sd:pagination-sort="code" th:text="#{common.code}">Code</a></th>
                    <th><a class="sorting" sd:pagination-sort="message" th:text="#{common.message}">Message</a></th>
                    <th><a class="sorting" sd:pagination-sort="field" th:text="#{common.field}">Champ</a></th>
                    <th><a class="sorting" sd:pagination-sort="date" th:text="#{common.date}">Date</a></th>
                    <th><a class="sorting" sd:pagination-sort="crousOperation" th:text="#{common.crous}">Opération CROUS</a></th>
                    <th><a class="sorting" sd:pagination-sort="esupSgcOperation" th:text="#{common.esupsgc}">Opération ESUP-SGC</a></th>
                    <th><a class="sorting" sd:pagination-sort="crousUrl" th:text="#{common.crous}">URL CROUS</a></th>
                    <th>
                        <a class="sorting" sd:pagination-sort="tryCount" th:text="#{list.attempts.count}">Nb d'essais</a>
                    </th>
                    <th>
                        <a class="sorting" sd:pagination-sort="blocking" th:text="#{common.blocking}">Bloquant</a>
                    </th>
                    <th th:text="#{common.actions}">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="log : ${crouserrorlogs}">
                    <td>
                        <a th:href="@{'/manager/' + ${log.cardId}}" th:text="${log.cardId}"></a>
                    </td>
                    <td>
                        <a th:href="@{'/manager?eppn=' + ${log.userEppn}}" th:text="${log.userEppn}"></a>
                    </td>
                    <td th:text="${log.userDisplayName}"></td>
                    <td th:text="${log.userEmail}"></td>
                    <td th:text="${log.cardCsn}"></td>
                    <td th:text="${log.code}"></td>
                    <td th:text="${log.message}"></td>
                    <td th:text="${log.field}"></td>
                    <td th:text="${#temporals.format(log.date, 'dd/MM/yy HH:mm')}"></td>
                    <td th:text="${log.crousOperation}"></td>
                    <td th:text="${log.esupSgcOperation}"></td>
                    <td th:text="${log.crousUrl}"></td>
                    <td th:text="${log.tryCount}"></td>
                    <td th:text="${log.blocking}"></td>
                    <td>
                        <a class="btn btn-primary" th:href="@{/admin/crouserrorlogs/{id}(id=${log.id})}">
                            <span class="glyphicon glyphicon-eye-open" th:text="#{common.view}">Voir</span>
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
         <div class="text-center">
             <nav>
                <div class="btn-group">
                    <div class="btn-group dropup" sd:page-size-selector="dropdown" style="margin-top: 20px"></div>
                    <ul class="btn-group pagination" sd:pagination="full"></ul>
                </div>
            </nav>
        </div>
    </div>
</div>
</body>
</html>